name: Upload URL to WeTransfer

on:
  workflow_dispatch: # 手动触发工作流
    inputs:
      file_url:
        description: 'The URL of the file to upload'
        required: true

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: pip install WeTransferTool requests

      - name: Download file from URL
        env:
          FILE_URL: ${{ github.event.inputs.file_url }}
        run: |
          # 从URL中提取文件名，或自定义一个
          FILENAME="downloaded_file"
          wget -O "$FILENAME" "$FILE_URL"
          echo "FILE_PATH=$FILENAME" >> $GITHUB_ENV

      - name: Upload to WeTransfer using Python
        run: |
          python -c "
          from WeTransferTool import We
          import os
          wet = We()
          # 上传文件，可自定义消息
          metadata = wet.upload(os.environ['FILE_PATH'], 'My File', 'Uploaded via GitHub Actions')
          print('Download Link:', metadata.get('shortened_url'))
          print('File expires at:', metadata.get('expires_at'))
          "
